<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>GraphITI — Minimal Docs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #0b1020;
        --card: #121933;
        --ink: #eaf0ff;
        --muted: #a9b3d1;
        --acc: #7aa2ff;
        --ok: #39d98a;
        --warn: #ffd166;
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        --sans: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji",
          "Segoe UI Emoji";
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        background: var(--bg);
        color: var(--ink);
        font-family: var(--sans);
        margin: 0;
      }
      .wrap {
        max-width: 1000px;
        margin: 48px auto;
        padding: 0 20px;
      }
      .title {
        font-weight: 800;
        letter-spacing: 0.2px;
        font-size: 34px;
        line-height: 1.15;
        margin: 0 0 6px;
      }
      .sub {
        color: var(--muted);
        margin: 0 0 24px;
      }
      .grid {
        display: grid;
        gap: 18px;
      }
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.03),
          rgba(255, 255, 255, 0.01)
        );
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 14px;
        padding: 18px 18px;
      }
      h2 {
        font-size: 18px;
        margin: 0 0 8px;
      }
      h3 {
        font-size: 16px;
        margin: 14px 0 8px;
      }
      p {
        color: var(--ink);
        opacity: 0.95;
        margin: 8px 0;
      }
      code,
      pre {
        font-family: var(--mono);
        font-size: 12.5px;
        background: #0d1430;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 10px;
      }
      code {
        padding: 0.15em 0.35em;
      }
      pre {
        padding: 12px 14px;
        white-space: pre-wrap;
      }
      .tag {
        display: inline-block;
        font-size: 11px;
        padding: 0.25em 0.5em;
        border: 1px solid rgba(255, 255, 255, 0.18);
        border-radius: 999px;
        color: var(--muted);
        margin-right: 6px;
      }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: #0f1838;
        border: 1px solid rgba(255, 255, 255, 0.12);
        padding: 6px 10px;
        border-radius: 999px;
        color: #cbd5ff;
      }
      .ok {
        color: var(--ok);
      }
      .warn {
        color: var(--warn);
      }
      .acc {
        color: var(--acc);
      }
      .cols {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 18px;
      }
      @media (max-width: 850px) {
        .cols {
          grid-template-columns: 1fr;
        }
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
      }
      th,
      td {
        padding: 8px 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        text-align: left;
      }
      th {
        color: #c7d2fe;
      }
      svg {
        width: 100%;
        height: auto;
        display: block;
      }
      .hr {
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.15),
          transparent
        );
        margin: 18px 0;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="title">GraphITI — End-to-End Mini Docs</div>
      <p class="sub">
        Tiny system to turn unstructured emails into a Neo4j project graph + a
        Qdrant vector index, with a CLI agent to
        <span class="pill">READ</span> or <span class="pill">MODIFY</span>.
      </p>

      <div class="card">
        <h2>How it fits together</h2>
        <svg viewBox="0 0 1200 250" role="img" aria-label="Flow">
          <defs>
            <linearGradient id="g" x1="0" x2="1">
              <stop stop-color="#7aa2ff" offset="0" />
              <stop stop-color="#39d98a" offset="1" />
            </linearGradient>
          </defs>
          <g
            fill="none"
            stroke="#94a3b8"
            stroke-width="2"
            stroke-linecap="round"
          >
            <rect
              x="10"
              y="30"
              rx="10"
              ry="10"
              width="250"
              height="70"
              fill="#0f1838"
            />
            <text
              x="135"
              y="62"
              text-anchor="middle"
              fill="#cbd5ff"
              font-size="14"
            >
              raw_data/past_emails.json
            </text>
            <text
              x="135"
              y="82"
              text-anchor="middle"
              fill="#9fb0ff"
              font-size="12"
            >
              historical emails
            </text>

            <rect
              x="280"
              y="30"
              rx="10"
              ry="10"
              width="220"
              height="70"
              fill="#0f1838"
            />
            <text
              x="390"
              y="62"
              text-anchor="middle"
              fill="#cbd5ff"
              font-size="14"
            >
              make_embedings.py
            </text>
            <text
              x="390"
              y="82"
              text-anchor="middle"
              fill="#9fb0ff"
              font-size="12"
            >
              GPT triplets + embeddings
            </text>

            <rect
              x="520"
              y="30"
              rx="10"
              ry="10"
              width="230"
              height="70"
              fill="#0f1838"
            />
            <text
              x="635"
              y="62"
              text-anchor="middle"
              fill="#cbd5ff"
              font-size="14"
            >
              Qdrant (emails_past)
            </text>
            <text
              x="635"
              y="82"
              text-anchor="middle"
              fill="#9fb0ff"
              font-size="12"
            >
              vectors + triples payload
            </text>

            <rect
              x="770"
              y="30"
              rx="10"
              ry="10"
              width="190"
              height="70"
              fill="#0f1838"
            />
            <text
              x="865"
              y="62"
              text-anchor="middle"
              fill="#cbd5ff"
              font-size="14"
            >
              output/output.json
            </text>
            <text
              x="865"
              y="82"
              text-anchor="middle"
              fill="#9fb0ff"
              font-size="12"
            >
              local graph backup
            </text>

            <rect
              x="980"
              y="30"
              rx="10"
              ry="10"
              width="210"
              height="70"
              fill="#0f1838"
            />
            <text
              x="1085"
              y="62"
              text-anchor="middle"
              fill="#cbd5ff"
              font-size="14"
            >
              Neo4j
            </text>
            <text
              x="1085"
              y="82"
              text-anchor="middle"
              fill="#9fb0ff"
              font-size="12"
            >
              source of truth
            </text>

            <line x1="260" y1="65" x2="280" y2="65" stroke="url(#g)" />
            <line x1="500" y1="65" x2="520" y2="65" stroke="url(#g)" />
            <line x1="750" y1="65" x2="770" y2="65" stroke="url(#g)" />
            <line x1="960" y1="65" x2="980" y2="65" stroke="url(#g)" />

            <rect
              x="10"
              y="150"
              rx="10"
              ry="10"
              width="330"
              height="70"
              fill="#0f1838"
            />
            <text
              x="175"
              y="182"
              text-anchor="middle"
              fill="#cbd5ff"
              font-size="14"
            >
              retrieval_agent.py
            </text>
            <text
              x="175"
              y="202"
              text-anchor="middle"
              fill="#9fb0ff"
              font-size="12"
            >
              tools: extract → retrieve → plan
            </text>

            <line x1="345" y1="185" x2="520" y2="65" stroke="url(#g)" />
            <line x1="345" y1="185" x2="770" y2="65" stroke="url(#g)" />
            <line x1="345" y1="185" x2="980" y2="65" stroke="url(#g)" />
          </g>
        </svg>
        <div class="hr"></div>
        <span class="tag">schema.json</span>
        <span class="tag">tools.py</span>
        <span class="tag">bootstrap_neo4j.py</span>
        <span class="tag">Qdrant (Docker)</span>
        <span class="tag">Neo4j (Desktop/Server)</span>
      </div>

      <div class="cols">
        <div class="card">
          <h2>Quick Start</h2>
          <h3>1) Start services</h3>
          <pre>
docker run -d --name qdrant -p 6333:6333 -p 6334:6334 qdrant/qdrant
# Neo4j running at bolt://localhost:7687 (Desktop or Server)</pre
          >

          <h3>2) Set environment</h3>
          <pre>
# Windows PowerShell
$env:OPENAI_API_KEY="sk-..."
$env:NEO4J_PASSWORD="yourPassword"</pre
          >

          <h3>3) Embed & index historical emails</h3>
          <pre>
python make_embedings.py   # creates Qdrant collection with vectors + triples</pre
          >

          <h3>4) Seed Neo4j from local backup (optional)</h3>
          <pre>python bootstrap_neo4j.py  # imports output/output.json</pre>

          <h3>5) Ask the agent</h3>
          <pre>
python retrieval_agent.py
Query&gt; READ what parts does Project Apollo use?
# or
Query&gt; MODIFY set Apollo status to on_hold from 2025-09-05</pre
          >
        </div>

        <div class="card">
          <h2>
            What happens on
            <span class="pill"><span class="ok">READ</span> mode</span>
          </h2>
          <ul>
            <li>
              TOOL 1 — Extracts node mentions from your query (schema-aware).
            </li>
            <li>
              TOOL 2 — Pulls top-3 matching facts per node from Qdrant (vectors
              + triples).
            </li>
            <li>
              TOOL 3 — Builds a prompt with <em>facts as ground truth</em> and
              returns an answer.
            </li>
            <li>
              <strong>No writes</strong> to Neo4j.
              <strong>No changes</strong> to <code>output/output.json</code>.
            </li>
          </ul>
          <div class="hr"></div>
          <h2>
            What happens on
            <span class="pill"><span class="warn">MODIFY</span> mode</span>
          </h2>
          <ul>
            <li>Same steps 1 &amp; 2 (extract + retrieve).</li>
            <li>
              TOOL 3 — Produces a
              <strong>schema-validated plan</strong> (nodes_to_merge,
              relationships_to_merge).
            </li>
            <li>
              Updates <code>output/output.json</code> (local backup) with
              merges.
            </li>
            <li>
              Executes corresponding <strong>MERGE</strong> writes in Neo4j
              (source of truth).
            </li>
          </ul>
        </div>
      </div>

      <div class="grid" style="margin-top: 18px">
        <div class="card">
          <h2>Validation & Safety Rails</h2>
          <p>
            The agent validates all AI outputs against your
            <code>schema.json</code> in two places:
          </p>
          <ol>
            <li>
              <strong>Node extraction</strong> (TOOL 1): drops unknown labels
              and strips disallowed properties.
            </li>
            <li>
              <strong>Plan application</strong> (TOOL 3): prunes
              node/relationship types and properties to the schema before any
              write. Unknowns are discarded.
            </li>
          </ol>
          <p class="muted">
            Neo4j merges use identity rules: <code>Part.part_id</code> or
            <code>name</code> (others). Fallbacks use literal maps (never
            <code>MERGE (n:Label $props)</code>).
          </p>
        </div>

        <div class="card">
          <h2>Files Overview</h2>
          <table>
            <thead>
              <tr>
                <th>File</th>
                <th>Purpose</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>schema.json</code></td>
                <td>
                  Allowed node labels, relationship types, and properties (with
                  validity props on relationships).
                </td>
              </tr>
              <tr>
                <td><code>raw_data/past_emails.json</code></td>
                <td>
                  30 condensed historical emails leading to mid-project state.
                </td>
              </tr>
              <tr>
                <td><code>make_embedings.py</code></td>
                <td>
                  Builds concatenated email text, extracts triples via GPT
                  (schema-bound), embeds, upserts into Qdrant.
                </td>
              </tr>
              <tr>
                <td><code>output/output.json</code></td>
                <td>Local JSON backup of the current graph.</td>
              </tr>
              <tr>
                <td><code>bootstrap_neo4j.py</code></td>
                <td>
                  Simple one-shot importer of <code>output.json</code> into
                  Neo4j with basic constraints.
                </td>
              </tr>
              <tr>
                <td><code>tools.py</code></td>
                <td>
                  Implements TOOL 1/2/3, vector search, plan pruning,
                  local/Neo4j merges.
                </td>
              </tr>
              <tr>
                <td><code>retrieval_agent.py</code></td>
                <td>
                  CLI agent orchestrating extract → retrieve → plan
                  (READ/MODIFY).
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="card" style="margin-top: 18px">
        <h2>Tips</h2>
        <ul>
          <li>
            If Neo4j errors on MERGE, ensure nodes have identities (<code
              >name</code
            >
            or <code>part_id</code>) in <code>output.json</code>.
          </li>
          <li>
            Confirm Qdrant is running at <code>http://localhost:6333</code> and
            the collection name matches <code>QDRANT_COLLECTION</code>.
          </li>
          <li>
            Use precise dates (ISO <code>YYYY-MM-DD</code>) for relationship
            validity (<code>valid_from</code>/<code>valid_to</code>).
          </li>
        </ul>
        <p class="muted">
          Environment: <code>OPENAI_API_KEY</code>, <code>NEO4J_URI</code>,
          <code>NEO4J_USER</code>, <code>NEO4J_PASSWORD</code>,
          <code>QDRANT_HOST</code>, <code>QDRANT_PORT</code>,
          <code>QDRANT_COLLECTION</code>, <code>EMBED_MODEL</code>,
          <code>LLM_MODEL</code>.
        </p>
      </div>

      <p style="text-align: center; color: #94a3b8; margin-top: 22px">
        Built for clarity. Keep your schema tight, and your writes boring. ✨
      </p>
    </div>
  </body>
</html>
